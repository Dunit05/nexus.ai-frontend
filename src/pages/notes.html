<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nexus AI - Notes</title>
    <link rel="stylesheet" href="../styles/nav.css" />
    <link rel="stylesheet" href="../styles/notes.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <style>

    </style>
  </head>
  <body>
    <!-- Custom Title Bar (Now at the top) -->
    <div class="title-bar">
    
      <div class="nav-buttons">
        <a href="home.html"><button class="nav-button"><i class="fas fa-home"></i></button></a>
          <button class="nav-button"><i class="fas fa-calendar-alt"></i></button>
          <button class="nav-button"><i class="fas fa-moon"></i></button>
      </div>
  
      <div class="title-right">
          <button id="close">âœ•</button>
      </div>
  </div>

    <!-- Notes Container -->
    <div class="container">
      <h2>ğŸ“Œ Notes, Reminders & To-Do List</h2>

      <label for="note-type">Choose Type:</label>
      <select id="note-type">
        <option value="summary">ğŸ“ Summary</option>
        <option value="reminder">â° Reminder</option>
        <option value="todo">âœ… To-Do</option>
      </select>

      <label for="note-input">Enter your note:</label>
      <input
        type="text"
        id="note-input"
        placeholder="Write your note here..."
      />

      <button id="add-note">Add Note</button>

      <div class="notes-container">
        <h3>ğŸ—’ My Notes:</h3>
        <div id="notes-list">
          <!-- Notes will be dynamically added here -->
        </div>
      </div>
    </div>

    <script>
      document
        .getElementById("add-note")
        .addEventListener("click", async function () {
          const noteType = document.getElementById("note-type").value;
          const noteInput = document.getElementById("note-input").value.trim();
          if (!noteInput) {
            alert("Please enter a note.");
            return;
          }

          let endpoint = "";
          if (noteType === "summary") {
            endpoint = "/summarize";
          } else if (noteType === "reminder") {
            endpoint = "/add_reminder";
          } else if (noteType === "todo") {
            endpoint = "/add_task";
          }

          const requestData = {
            message: noteInput,
            user_id: "hackhive",
          };

          try {
            const response = await fetch(
              `https://nexus-ai-backend-omnu.onrender.com${endpoint}`,
              {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(requestData),
              }
            );

            const data = await response.json();
            console.log("Note Added:", data);

            alert("Note added successfully!");
            document.getElementById("note-input").value = "";
            fetchNotes();
          } catch (error) {
            console.error("Error adding note:", error);
            alert("Failed to add note.");
          }
        });

      async function fetchNotes() {
        try {
          const summaries = await fetchData("summaries");
          const reminders = await fetchData("reminders");
          const tasks = await fetchData("tasks");

          document.getElementById("notes-list").innerHTML = `
            ${summaries.map(noteTemplate("Summary", "summary-note")).join("")}
            ${reminders.map(reminderTemplate).join("")}
            ${tasks.map(noteTemplate("To-Do", "todo-note")).join("")}
          `;
        } catch (error) {
          console.error("Error fetching notes:", error);
        }
      }

      async function fetchData(type) {
        const res = await fetch(
          `https://nexus-ai-backend-omnu.onrender.com/${type}/hackhive`
        );
        return await res.json();
      }

      function noteTemplate(type, cssClass) {
        return (note) => `
          <div class="note ${cssClass}">
            <h4>${type}</h4>
            <p>${note.summary || note.task}</p>
            <small>${formatDate(note.timestamp)}</small>
          </div>
        `;
      }

      function reminderTemplate(reminder) {
        return `
          <div class="note reminder-note">
            <h4>â° Reminder (${reminder.repeat})</h4>
            <p>${reminder.reminder_text}</p>
            <small>${formatDate(reminder.timestamp)}</small>
          </div>
        `;
      }

      function formatDate(timestamp) {
        if (!timestamp) return "No Date Provided";
        return new Date(timestamp).toLocaleString("en-US", {
          month: "long",
          day: "numeric",
          year: "numeric",
          hour: "numeric",
          minute: "2-digit",
          hour12: true,
        });
      }

      fetchNotes();
    </script>
  </body>
</html>
